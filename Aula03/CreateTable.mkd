# CREATE TABLE, Constraints e Modelagem de Dados

## Banco de Dados Biblioteca â€“ Aula PrÃ¡tica

Nesta aula, vamos **estruturar um banco de dados completo**, criando tabelas, definindo tipos de dados, aplicando **constraints** e entendendo o **relacionamento entre as tabelas** por meio do diagrama lÃ³gico.

Mesmo jÃ¡ tendo visto como criar um banco de dados anteriormente, vamos **relembrar a criaÃ§Ã£o via cÃ³digo**, pois este banco serÃ¡ utilizado ao longo do curso.

---

## 1. Criando o banco de dados do curso

Aqui criamos o banco **Biblioteca**, definindo arquivos de dados, log e regras de crescimento.

```sql
CREATE DATABASE Biblioteca
ON PRIMARY(
    NAME = Biblioteca,
    FILENAME = 'C:\SQL\Biblioteca.mdf',
    SIZE = 8MB,
    MAXSIZE = 15MB,
    FILEGROWTH = 10%
)
LOG ON(
    NAME = Biblioteca_log,
    FILENAME = 'C:\SQL\Biblioteca.ldf',
    SIZE = 1MB,
    FILEGROWTH = 1MB
);
GO

USE Biblioteca;
```

ðŸ“Œ Este banco serÃ¡ a base de dados oficial usada durante as aulas.

---

## 2. EstratÃ©gia de criaÃ§Ã£o das tabelas

Antes de sair criando tudo de uma vez, seguimos uma **boa prÃ¡tica**:

1. Criar primeiro as tabelas **sem chave estrangeira**
2. Depois criar as tabelas que **dependem de outras**
3. Por Ãºltimo, criar **tabelas associativas** (N:N)

Isso evita erros de integridade referencial.

---

## 3. Tabelas sem chave estrangeira

### 3.1 Tabela Autor

Armazena os autores dos livros.

```sql
CREATE TABLE Autor(
    IdAutor SMALLINT IDENTITY,
    NomeAutor VARCHAR(50) NOT NULL,
    SobreNomeAutor VARCHAR(60) NOT NULL,
    CONSTRAINT pk_id_autor PRIMARY KEY(IdAutor)
);
```

ðŸ“Œ Destaques:

* `IDENTITY`: gera o ID automaticamente
* `NOT NULL`: campos obrigatÃ³rios
* `PRIMARY KEY`: identifica o autor de forma Ãºnica

---

### 3.2 Tabela Editora

Armazena as editoras responsÃ¡veis pelas publicaÃ§Ãµes.

```sql
CREATE TABLE Editora(
    IdEditora SMALLINT PRIMARY KEY IDENTITY,
    NomeEditora VARCHAR(50) NOT NULL
);
```

---

### 3.3 Tabela Assunto

Define os assuntos ou categorias dos livros.

```sql
CREATE TABLE Assunto(
    IdAssunto TINYINT PRIMARY KEY IDENTITY,
    NomeAssunto VARCHAR(25) NOT NULL
);
```

ðŸ“Œ Note o uso do `TINYINT`, ideal para tabelas pequenas e controladas.

---

## 4. Tabela com chaves estrangeiras

### 4.1 Tabela Livro

A tabela **Livro** Ã© o coraÃ§Ã£o do sistema. Ela se relaciona com **Editora** e **Assunto**.

```sql
CREATE TABLE Livro(
    IdLivro SMALLINT PRIMARY KEY IDENTITY,
    NomeLivro VARCHAR(70) NOT NULL,
    ISBN13 CHAR(13) UNIQUE NOT NULL,
    DataPub DATE,
    PrecoLivro MONEY NOT NULL,
    NumeroPaginas SMALLINT NOT NULL,
    IdEditora SMALLINT NOT NULL,
    IdAssunto TINYINT NOT NULL,

    CONSTRAINT fk_id_editora FOREIGN KEY(IdEditora)
        REFERENCES Editora(IdEditora) ON DELETE CASCADE,

    CONSTRAINT fk_id_assunto FOREIGN KEY(IdAssunto)
        REFERENCES Assunto(IdAssunto) ON DELETE CASCADE,

    CONSTRAINT verifica_preco CHECK(PrecoLivro >= 0)
);
```

ðŸ“Œ Constraints utilizadas:

* `PRIMARY KEY`: identifica o livro
* `UNIQUE`: garante ISBN Ãºnico
* `FOREIGN KEY`: mantÃ©m integridade referencial
* `CHECK`: impede preÃ§os negativos
* `ON DELETE CASCADE`: remove livros se a editora ou assunto for apagado

---

## 5. Tabela associativa (Relacionamento N:N)

### 5.1 Tabela LivroAutor

Um livro pode ter **vÃ¡rios autores** e um autor pode escrever **vÃ¡rios livros**.

```sql
CREATE TABLE LivroAutor(
    IdLivro SMALLINT NOT NULL,
    IdAutor SMALLINT NOT NULL,

    CONSTRAINT fk_id_livros FOREIGN KEY(IdLivro)
        REFERENCES Livro(IdLivro),

    CONSTRAINT fk_id_autores FOREIGN KEY(IdAutor)
        REFERENCES Autor(IdAutor),

    CONSTRAINT pk_livro_autor PRIMARY KEY(IdLivro, IdAutor)
);
```

ðŸ“Œ Aqui temos:

* Chave primÃ¡ria composta
* Duas chaves estrangeiras
* ImplementaÃ§Ã£o clÃ¡ssica de relacionamento muitos-para-muitos

---

## 6. Diagrama lÃ³gico das tabelas

> ðŸ“· <img src="diagrama.JPG" alt="Minha imagem legal" />

Relacionamentos:

* **Editora (1) â†’ (N) Livro**
* **Assunto (1) â†’ (N) Livro**
* **Livro (N) â†” (N) Autor** (via LivroAutor)

O diagrama ajuda a visualizar:

* DependÃªncia entre tabelas
* Chaves primÃ¡rias e estrangeiras
* Estrutura geral do banco

---

## 7. Verificando as tabelas criadas

Para listar todas as tabelas do banco:

```sql
SELECT name
FROM Biblioteca.sys.tables;
```

---



